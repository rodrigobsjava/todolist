<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR" xml:lang="pt-BR">

<head>
	<title>Minhas Tarefas</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
	<link rel="stylesheet" th:href="@{/css/style.css}" />
	<link id="app-icon" rel="icon" type="image/png" th:href="@{/img/icon-light.png}" />
</head>

<body class="bg-light page-dashboard">

	<!-- Top bar / ações globais -->
	<header class="container py-3" aria-label="Barra superior">
		<div class="d-flex justify-content-end">
			<button id="toggle-theme" class="btn btn-sm btn-primary" type="button" aria-label="Alternar tema">
				<i class="bi bi-moon me-1" aria-hidden="true"></i>
			</button>
		</div>
	</header>

	<main class="container pb-4" aria-label="Conteúdo principal">

		<!-- Cabeçalho da página -->
		<section class="mb-3" aria-labelledby="page-title">
			<div
				class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
				<h1 id="page-title" class="h2 m-0">Minhas Tarefas</h1>

				<div class="d-flex gap-2">
					<a th:href="@{/tasks/new}" class="btn btn-primary">
						<i class="bi bi-plus-lg me-1" aria-hidden="true"></i> Nova Tarefa
					</a>

					<form th:action="@{/logout}" method="post" class="m-0">
						<button type="submit" class="btn btn-outline-danger">
							<i class="bi bi-box-arrow-right me-1" aria-hidden="true"></i> Sair
						</button>
					</form>
				</div>
			</div>
		</section>

		<!-- Flash messages -->
		<section class="mb-3" aria-label="Mensagens do sistema">
			<div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
				<span th:text="${successMessage}"></span>
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
			</div>

			<div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
				<span th:text="${errorMessage}"></span>
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
			</div>
		</section>

		<!-- Lista de tarefas -->
		<section aria-label="Lista de tarefas">
			<div class="list-group">

				<article class="list-group-item" th:each="task : ${tasks}"
					th:classappend="${task.completed} ? 'task-completed' : ''">

					<div
						class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-3">

						<!-- Conteúdo da tarefa -->
						<div class="flex-grow-1">

							<!-- título -->
							<h2 class="h5 mb-1" th:text="${task.title}"
								th:classappend="${task.completed} ? 'text-decoration-line-through text-muted' : ''">
								Título
							</h2>

							<!-- descrição -->
							<p class="mb-2 text-secondary" th:text="${task.description}">Descrição</p>

							<!-- status (ação) -->
							<form th:action="@{/tasks/{id}/toggle-status(id=${task.id})}" method="post"
								class="d-inline">
								<input type="hidden" name="page" th:value="${currentPage}" />

								<button type="submit" class="badge border-0"
									th:classappend="${task.completed} ? ' bg-success' : ' bg-warning'"
									th:attr="aria-label=${task.completed} ? 'Marcar como pendente' : 'Marcar como concluída'">
									<i class="bi"
										th:classappend="${task.completed} ? ' bi-check-circle-fill' : ' bi-hourglass-split'"
										aria-hidden="true"></i>
								</button>

								<span class="ms-1" th:text="${task.completed ? 'Concluída' : 'Pendente'}"></span>
							</form>
						</div>

						<!-- Ações -->
						<div class="text-sm-end d-flex flex-row flex-sm-column gap-2">

							<a th:href="@{/tasks/edit/{id}(id=${task.id})}" class="btn btn-sm btn-warning">
								<i class="bi bi-pencil-square me-1" aria-hidden="true"></i> Editar
							</a>

							<form th:action="@{/tasks/delete/{id}(id=${task.id})}" method="post" class="m-0">
								<button type="submit" class="btn btn-sm btn-danger"
									onclick="return confirm('Deseja excluir esta tarefa?')">
									<i class="bi bi-trash-fill me-1" aria-hidden="true"></i> Excluir
								</button>
							</form>

						</div>
					</div>

				</article>

			</div>
		</section>

		<!-- Paginação -->
		<nav th:if="${totalPages > 1}" class="mt-4" aria-label="Paginação">
			<ul class="pagination justify-content-center">

				<li class="page-item" th:classappend="${currentPage == 0} ? ' disabled'">
					<a class="page-link" th:href="@{/tasks(page=${currentPage - 1})}">Anterior</a>
				</li>

				<li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
					th:classappend="${i == currentPage} ? ' active'">
					<a class="page-link" th:href="@{/tasks(page=${i})}" th:text="${i + 1}"></a>
				</li>

				<li class="page-item" th:classappend="${currentPage + 1 == totalPages} ? ' disabled'">
					<a class="page-link" th:href="@{/tasks(page=${currentPage + 1})}">Próxima</a>
				</li>

			</ul>
		</nav>

	</main>

	<script th:src="@{/js/theme-toggle.js}"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>